<?xml version="1.0" encoding="UTF-8"?>
<!--
/*
* Copyright (C) 1999-2020 John Källén.
*
* This program is free software; you can redistribute it and/or modify
* it under the terms of the GNU General Public License as published by
* the Free Software Foundation; either version 2, or (at your option)
* any later version.
*
* This program is distributed in the hope that it will be useful,
* but WITHOUT ANY WARRANTY; without even the implied warranty of
* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
* GNU General Public License for more details.
*
* You should have received a copy of the GNU General Public License
* along with this program; see the file COPYING.  If not, write to
* the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
*/
-->
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">

  <?include Properties.wxi ?>

  <!-- The ID='*' means this Guid will be auto-generated by WiX. Don't rely on this!
       Instead, make sure you upgrade the Id every time you upgrade the version -->

  <Product
    Id="$(var.RekoProductCode)"
    Version="$(var.RekoVersion)"
    Name="$(var.ProductName)"
    Language="1033"
    Manufacturer="jklSoft"
    UpgradeCode="$(var.UpgradeCode)">

    <Package
      InstallerVersion="200"
      Compressed="yes"
      InstallScope="perMachine"></Package>

    <MajorUpgrade DowngradeErrorMessage="A newer version of [ProductName] is already installed." />

    <MediaTemplate EmbedCab="yes"/>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="$(var.PlatformProgramFilesFolder)">
        <Directory Id="jklSoftFolder" Name="jklSoft">
          <Directory Id="INSTALLFOLDER" Name="Reko">
            <Directory Id="Os2_16Folder" Name="os2-16" /> <!-- Folder for OS/2 16-bit specific files-->
            <Directory Id="Os2_32Folder" Name="os2-32" /> <!-- Folder for OS/2 32-bit specific files-->
          </Directory>
        </Directory>
      </Directory>
      <Directory Id="ProgramMenuFolder">
        <Directory Id="ApplicationProgramsFolder" Name="Reko Decompiler"/>
      </Directory>
    </Directory>

    <DirectoryRef Id="ApplicationProgramsFolder">
      <Component Id="ApplicationShortcut" Guid="BAA295FE-414E-4043-B865-66278DEC98AE">
        <Shortcut Id="ApplicationStartMenuShortcut"
                  Name="Reko Decompiler"
                  Description="Decompiles binary executable files"
                  Target="[INSTALLFOLDER]WindowsDecompiler.exe"
                  WorkingDirectory="INSTALLFOLDER"/>
        <RemoveFolder Id="ApplicationProgramsFolder" On="uninstall"/>
        <RegistryValue Root="HKCU" Key="Software\jklSoft\Decompiler" Name="installed" Type="integer" Value="1" KeyPath="yes"/>
      </Component>
    </DirectoryRef>

    <ComponentGroup
        Id="ProductComponents"
        Directory="INSTALLFOLDER">
      <Component
        Id="ProductComponent"
        Guid="9C3E003B-43CB-47B3-B5B8-DC6373A38AE1">
        <!-- Insert files, registry keys, and other resources here. -->
        
        <!-- Core binaries -->
        <File Source="$(var.Core.TargetPath)" />
        <File Source="$(var.Decompiler.TargetPath)" />
        <File Source="$(var.Gui.TargetPath)" />
        <File Source="$(var.WindowsForms.TargetPath)" />
        <File Source="$(var.WindowsDecompiler.TargetPath)" Id="F_DecompilerExecutable"/>
        <File Source="$(var.WindowsDecompiler.TargetPath).config" Id="F_WindowsDecompilerConfig" />
        <File Source="$(var.WindowsDecompiler.ProjectDir)app.config" Name="decompile.exe.config" />
        <File Source="$(var.WindowsDecompiler.ProjectDir)..\reko.config" Name="reko.config" />

        <File Source="$(var.CmdLine.TargetPath)" />
        
        <!-- Image loaders -->
        <File Source="$(var.BinHex.TargetPath)" />
        <File Source="$(var.Coff.TargetPath)" />
        <File Source="$(var.Dol.TargetPath)" />
        <File Source="$(var.Elf.TargetPath)" />
        <File Source="$(var.HpSom.TargetPath)" />
        <File Source="$(var.Hunk.TargetPath)" />
        <File Source="$(var.IntelHex.TargetPath)" />
        <File Source="$(var.MachO.TargetPath)" />
        <File Source="$(var.MzExe.TargetPath)" />
        <File Source="$(var.Nro.TargetPath)" />
        <File Source="$(var.OdbgScript.TargetPath)" />
        <File Source="$(var.Srec.TargetPath)" />
        <File Source="$(var.VmsExe.TargetPath)" />
        <File Source="$(var.Xbe.TargetPath)" />
        <File Source="$(var.Xex.TargetPath)" />

        <!-- Environments -->
        <File Source="$(var.AmigaOS.TargetPath)" />
        <File Source="$(var.AmigaOS.ProjectDir)exec.funcs" />
        <File Source="$(var.AmigaOS_Design.TargetPath)" />
        <File Source="$(var.AtariTOS.TargetPath)" />
        <File Source="$(var.AtariTOS.ProjectDir)atariTOS.xml" />
        <File Source="$(var.C64.TargetPath)" />
        <File Source="$(var.C64.ProjectDir)C64.xml" />
        <File Source="$(var.Cpm.TargetPath)" />
        <File Source="$(var.Cpm.ProjectDir)cpm_map.xml" />
        <File Source="$(var.Dreamcast.TargetPath)" />
        <File Source="$(var.Hpux.TargetPath)" />
        <File Source="$(var.MacOS.TargetPath)" />
        <File Source="$(var.MacOS.ProjectDir)/Classic/macos_classic.xml" />
        <File Source="$(var.MorphOS.TargetPath)" />
        <File Source="$(var.Msdos.TargetPath)" />
        <File Source="$(var.Msdos.ProjectDir)realmodeintservices.xml" />
        <File Source="$(var.Msdos.Design.TargetPath)" />
        <File Source="$(var.Ps3.TargetPath)" />
        <File Source="$(var.OS2.TargetPath)" />
        <File Source="$(var.RiscOS.TargetPath)" />
        <File Source="$(var.RT11.TargetPath)" />
        <File Source="$(var.RT11.ProjectDir)rt11_services.xml" />
        <File Source="$(var.SegaGenesis.TargetPath)" />
        <File Source="$(var.SegaGenesis.ProjectDir)SegaGenesis.xml" />
        <File Source="$(var.Switch.TargetPath)" />
        <File Source="$(var.SysV.TargetPath)" />
        <File Source="$(var.SysV.ProjectDir)lp32.xml" />
        <File Source="$(var.SysV.ProjectDir)libc.so.xml" />
        <File Source="$(var.SysV.ProjectDir)Xlib.xml" />
        <File Source="$(var.SysV.ProjectDir)sysvcharacteristics.xml" />
        <File Source="$(var.Trs80.ProjectDir)CoCoMemoryMap.xml" />
        <File Source="$(var.Trs80.ProjectDir)Trs80Rom.xml" />
        <File Source="$(var.Wii.TargetPath)" />
        <File Source="$(var.Windows.TargetPath)" />
        <File Source="$(var.Windows.ProjectDir)advapi32.xml" />
        <File Source="$(var.Windows.ProjectDir)comdlg32.xml" />
        <File Source="$(var.Windows.ProjectDir)commctrl.xml" />
        <File Source="$(var.Windows.ProjectDir)gdi32.xml" />
        <File Source="$(var.Windows.ProjectDir)kernel32.xml" />
        <File Source="$(var.Windows.ProjectDir)msvcrt.xml" />
        <File Source="$(var.Windows.ProjectDir)ntoskrnl.xml" />
        <File Source="$(var.Windows.ProjectDir)oleaut32.xml" />
        <File Source="$(var.Windows.ProjectDir)shell32.xml" />
        <File Source="$(var.Windows.ProjectDir)user32.xml" />
        <File Source="$(var.Windows.ProjectDir)win32characteristics.xml" />
        <File Source="$(var.Windows.ProjectDir)win64characteristics.xml" />
        <File Source="$(var.Windows.ProjectDir)windows_CE.xml" />
        <File Source="$(var.Windows.ProjectDir)windows32.xml" />
        <File Source="$(var.Windows.ProjectDir)windows64.xml" />
        <File Source="$(var.Windows.ProjectDir)wininet.xml" />
        <File Source="$(var.Windows.ProjectDir)winspool.xml" />
        <File Source="$(var.Windows.ProjectDir)wsock32.xml" />
        <File Source="$(var.Xbox.TargetPath)" />
        <File Source="$(var.Xbox.ProjectDir)/Xbox/xboxkernel.def" />
        <File Source="$(var.Xbox.ProjectDir)/Xbox360/xbox360krnl.def" />
        <File Source="$(var.ZX81.TargetPath)" />

        <!-- Architectures -->
        <File Source="$(var.Alpha.TargetPath)" />
        <File Source="$(var.Arc.TargetPath)" />
        <File Source="$(var.Arm.TargetPath)" />
        <File Source="$(var.Avr.TargetPath)" />
        <File Source="$(var.Blackfin.TargetPath)" />
        <File Source="$(var.Cray.TargetPath)" />
        <File Source="$(var.H8.TargetPath)" />
        <File Source="$(var.i8051.TargetPath)" />
        <File Source="$(var.LatticeMico.TargetPath)" />
        <File Source="$(var.M6800.TargetPath)" />
        <File Source="$(var.M68k.TargetPath)" />
        <File Source="$(var.M68k.Design.TargetPath)" />
        <File Source="$(var.MicroBlaze.TargetPath)" />
        <File Source="$(var.MicrochipPIC.TargetPath)" />
        <File Source="$(var.MicrochipPIC.Design.TargetPath)" />
        <File Source="$(var.Mips.TargetPath)" />
        <File Source="$(var.Mos6502.TargetPath)" />
        <File Source="$(var.MSP430.TargetPath)" />
        <File Source="$(var.OpenRISC.TargetPath)" />
        <File Source="$(var.PaRisc.TargetPath)" />
        <File Source="$(var.Pdp11.TargetPath)" />
        <File Source="$(var.PowerPC.TargetPath)" />
        <File Source="$(var.PowerPC.Design.TargetPath)" />
        <File Source="$(var.RiscV.TargetPath)" />
        <File Source="$(var.Rl78.TargetPath)" />
        <File Source="$(var.Sparc.TargetPath)" />
        <File Source="$(var.SuperH.TargetPath)" />
        <File Source="$(var.Tlcs.TargetPath)" />
        <File Source="$(var.Vax.TargetPath)" />
        <File Source="$(var.WE32100.TargetPath)" />
        <File Source="$(var.X86.TargetPath)" />
        <File Source="$(var.X86.Design.TargetPath)" />
        <File Source="$(var.Xtensa.TargetPath)" />
        <File Source="$(var.Z80.TargetPath)" />
        <File Source="$(var.SolutionDir)Native/build/$(var.Platform)/$(var.Configuration)/ArmNative/ArmNative.dll" />

        <!-- Symbol sources -->
        <File Source="$(var.LGSymLoader.TargetPath)" />
        
        <!-- Libraries -->
        <File Source="$(var.Libc.TargetPath)" />
        <File Source="$(var.Python.TargetPath)" />
        <File Source="$(var.Microchip.Utils.TargetPath)" />

        <!-- Unpacker signatures -->
        <File Source="$(var.Decompiler.ProjectDir)Loading\Signatures\IMAGE_FILE_MACHINE_AMD64.xml" />
        <File Source="$(var.Decompiler.ProjectDir)Loading\Signatures\IMAGE_FILE_MACHINE_ARM.xml" />
        <File Source="$(var.Decompiler.ProjectDir)Loading\Signatures\IMAGE_FILE_MACHINE_I386.xml" />
        <File Source="$(var.Decompiler.ProjectDir)Loading\Signatures\IMAGE_FILE_MACHINE_IA64.xml" />
        <File Source="$(var.Decompiler.ProjectDir)Loading\Signatures\PLATFORM_INDEPENDENT.xml" />
        
        <!-- Unpacker scripts -->
        <File Source="$(var.OdbgScript.ProjectDir)upx_ultimate.osc" />
        <File Source="$(var.OdbgScript.ProjectDir)RekoUnpacker_823.osc" />
        
        <!-- External files -->
        <File Source="$(var.SolutionDir)..\external\Capstone\$(var.Platform)\capstone.dll" />
        <File Source="$(var.SolutionDir)..\external\Msagl\Microsoft.Msagl.dll" />
        <File Source="$(var.SolutionDir)..\external\Msagl\Microsoft.Msagl.Drawing.dll" />
        <File Source="$(var.SolutionDir)..\external\Msagl\Microsoft.Msagl.GraphViewerGdi.dll" />
        
        <File Source="$(var.SolutionDir)..\external\reactos\coredll.def" />
        <File Source="$(var.SolutionDir)..\external\wine\commdlg.dll16.spec" />
        <File Source="$(var.SolutionDir)..\external\wine\gdi.exe16.spec" />
        <File Source="$(var.SolutionDir)..\external\wine\krnl386.exe16.spec" />
        <File Source="$(var.SolutionDir)..\external\wine\user.exe16.spec" />

        <!-- License files -->
        <File Source="$(var.SolutionDir)..\COPYING" Id="F_License" />
        
        <!-- PIC definition files -->
        <File Source="$(var.SolutionDir)tools\genPICdb\picdb.zip" />
        
      </Component>
    </ComponentGroup>

    <Component Id="Comp_Os2_16" Directory="Os2_16Folder" Guid="0444AAFF-1B7C-4182-AEEF-7DFCCDBC426C">
      <File Source="$(var.OS2.ProjectDir)os2-16.xml" />
      <File Id="File_Os2_16_ANSICALL" Source="$(var.OS2.ProjectDir)16\ANSICALL.def" />
      <File Id="File_Os2_16_BKSCALLS" Source="$(var.OS2.ProjectDir)16\BKSCALLS.def" />
      <File Id="File_Os2_16_BMSCALLS" Source="$(var.OS2.ProjectDir)16\BMSCALLS.def" />
      <File Id="File_Os2_16_BVH8514A" Source="$(var.OS2.ProjectDir)16\BVH8514A.def" />
      <File Id="File_Os2_16_BVHCGA" Source="$(var.OS2.ProjectDir)16\BVHCGA.def" />
      <File Id="File_Os2_16_BVHEGA" Source="$(var.OS2.ProjectDir)16\BVHEGA.def" />
      <File Id="File_Os2_16_BVHINIT" Source="$(var.OS2.ProjectDir)16\BVHINIT.def" />
      <File Id="File_Os2_16_BVHMPA" Source="$(var.OS2.ProjectDir)16\BVHMPA.def" />
      <File Id="File_Os2_16_BVHVGA" Source="$(var.OS2.ProjectDir)16\BVHVGA.def" />
      <File Id="File_Os2_16_BVHWNDW" Source="$(var.OS2.ProjectDir)16\BVHWNDW.def" />
      <File Id="File_Os2_16_BVHXGA" Source="$(var.OS2.ProjectDir)16\BVHXGA.def" />
      <File Id="File_Os2_16_BVSCALLS" Source="$(var.OS2.ProjectDir)16\BVSCALLS.def" />
      <File Id="File_Os2_16_DOSCALLS" Source="$(var.OS2.ProjectDir)16\DOSCALLS.def" />
      <File Id="File_Os2_16_DOSRFICO" Source="$(var.OS2.ProjectDir)16\DOSRFICO.def" />
      <File Id="File_Os2_16_HELPMGR" Source="$(var.OS2.ProjectDir)16\HELPMGR.def" />
      <File Id="File_Os2_16_KBDCALLS" Source="$(var.OS2.ProjectDir)16\KBDCALLS.def" />
      <File Id="File_Os2_16_LOCKDLL" Source="$(var.OS2.ProjectDir)16\LOCKDLL.def" />
      <File Id="File_Os2_16_MONCALLS" Source="$(var.OS2.ProjectDir)16\MONCALLS.def" />
      <File Id="File_Os2_16_MOUCALLS" Source="$(var.OS2.ProjectDir)16\MOUCALLS.def" />
      <File Id="File_Os2_16_MSG" Source="$(var.OS2.ProjectDir)16\MSG.def" />
      <File Id="File_Os2_16_NAMPIPES" Source="$(var.OS2.ProjectDir)16\NAMPIPES.def" />
      <File Id="File_Os2_16_NLS" Source="$(var.OS2.ProjectDir)16\NLS.def" />
      <File Id="File_Os2_16_OS2SM" Source="$(var.OS2.ProjectDir)16\OS2SM.def" />
      <File Id="File_Os2_16_OS2SMDUM" Source="$(var.OS2.ProjectDir)16\OS2SMDUM.def" />
      <File Id="File_Os2_16_PMDRAG" Source="$(var.OS2.ProjectDir)16\PMDRAG.def" />
      <File Id="File_Os2_16_PMGPI" Source="$(var.OS2.ProjectDir)16\PMGPI.def" />
      <File Id="File_Os2_16_PMSHAPI" Source="$(var.OS2.ProjectDir)16\PMSHAPI.def" />
      <File Id="File_Os2_16_PMSHLTKT" Source="$(var.OS2.ProjectDir)16\PMSHLTKT.def" />
      <File Id="File_Os2_16_PMSPL" Source="$(var.OS2.ProjectDir)16\PMSPL.def" />
      <File Id="File_Os2_16_PMTKT" Source="$(var.OS2.ProjectDir)16\PMTKT.def" />
      <File Id="File_Os2_16_PMTRACE" Source="$(var.OS2.ProjectDir)16\PMTRACE.def" />
      <File Id="File_Os2_16_PMVIOP" Source="$(var.OS2.ProjectDir)16\PMVIOP.def" />
      <File Id="File_Os2_16_PMWIN" Source="$(var.OS2.ProjectDir)16\PMWIN.def" />
      <File Id="File_Os2_16_PMWINDUM" Source="$(var.OS2.ProjectDir)16\PMWINDUM.def" />
      <File Id="File_Os2_16_QUECALLS" Source="$(var.OS2.ProjectDir)16\QUECALLS.def" />
      <File Id="File_Os2_16_REXX" Source="$(var.OS2.ProjectDir)16\REXX.def" />
      <File Id="File_Os2_16_REXXAPI" Source="$(var.OS2.ProjectDir)16\REXXAPI.def" />
      <File Id="File_Os2_16_SESMGR" Source="$(var.OS2.ProjectDir)16\SESMGR.def" />
      <File Id="File_Os2_16_SPOOLCP" Source="$(var.OS2.ProjectDir)16\SPOOLCP.def" />
      <File Id="File_Os2_16_VIOCALLS" Source="$(var.OS2.ProjectDir)16\VIOCALLS.def" />
      <File Source="$(var.OS2.ProjectDir)fsd.xml" />
      <File Source="$(var.OS2.ProjectDir)fsh.xml" />
      <File Source="$(var.OS2.ProjectDir)fsu.xml" />

    </Component>

    <Component Id="Comp_Os2_32" Directory="Os2_32Folder" Guid="17698BD8-9701-44F7-8D05-F42F450334C6">
      <File Source="$(var.OS2.ProjectDir)32\bdcalls.def" />
      <File Source="$(var.OS2.ProjectDir)32\dive.def" />
      <File Source="$(var.OS2.ProjectDir)32\DOSCALLS.def" />
      <File Source="$(var.OS2.ProjectDir)32\ftpapi.def" />
      <File Source="$(var.OS2.ProjectDir)32\glut.def" />
      <File Source="$(var.OS2.ProjectDir)32\helpmgr.def" />
      <File Source="$(var.OS2.ProjectDir)32\kbdcalls.def" />
      <File Source="$(var.OS2.ProjectDir)32\libaux.def" />
      <File Source="$(var.OS2.ProjectDir)32\libtk.def" />
      <File Source="$(var.OS2.ProjectDir)32\libuni.def" />
      <File Source="$(var.OS2.ProjectDir)32\mciapi.def" />
      <File Source="$(var.OS2.ProjectDir)32\mdm.def" />
      <File Source="$(var.OS2.ProjectDir)32\mmio.def" />
      <File Source="$(var.OS2.ProjectDir)32\moncalls.def" />
      <File Source="$(var.OS2.ProjectDir)32\moucalls.def" />
      <File Source="$(var.OS2.ProjectDir)32\msg.def" />
      <File Source="$(var.OS2.ProjectDir)32\nampipes.def" />
      <File Source="$(var.OS2.ProjectDir)32\nls.def" />
      <File Source="$(var.OS2.ProjectDir)32\opengl.def" />
      <File Source="$(var.OS2.ProjectDir)32\pmctls.def" />
      <File Source="$(var.OS2.ProjectDir)32\pmdrag.def" />
      <File Source="$(var.OS2.ProjectDir)32\pmgpi.def" />
      <File Source="$(var.OS2.ProjectDir)32\pmshapi.def" />
      <File Source="$(var.OS2.ProjectDir)32\pmspl.def" />
      <File Source="$(var.OS2.ProjectDir)32\pmviop.def" />
      <File Source="$(var.OS2.ProjectDir)32\pmwin.def" />
      <File Source="$(var.OS2.ProjectDir)32\pmwp.def" />
      <File Source="$(var.OS2.ProjectDir)32\quecalls.def" />
      <File Source="$(var.OS2.ProjectDir)32\rexx.def" />
      <File Source="$(var.OS2.ProjectDir)32\rexxapi.def" />
      <File Source="$(var.OS2.ProjectDir)32\rtmidi.def" />
      <File Source="$(var.OS2.ProjectDir)32\sesmgr.def" />
      <File Source="$(var.OS2.ProjectDir)32\sw.def" />
      <File Source="$(var.OS2.ProjectDir)32\tcpip32.def" />
      <File Source="$(var.OS2.ProjectDir)32\uconv.def" />
      <File Source="$(var.OS2.ProjectDir)32\upm32.def" />
      <File Source="$(var.OS2.ProjectDir)32\viocalls.def" />
    </Component>

    <Feature Id="ProductFeature" Title="Complete" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
      <ComponentRef Id="ApplicationShortcut" />
      <ComponentRef Id="Comp_Os2_16" />
      <ComponentRef Id="Comp_Os2_32" />
    </Feature>

    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLFOLDER" />

    <WixVariable Id="WixUILicenseRtf" Value="$(var.SolutionDir)..\COPYING.rtf" />
    
    <UIRef Id="WixUI_InstallDir" />

    <Property Id="ARPPRODUCTICON" Value="PackageIcon" />
    <Icon Id="PackageIcon" SourceFile="$(var.WindowsDecompiler.TargetPath)" />
  </Product>
</Wix>